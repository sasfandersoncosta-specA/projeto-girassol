<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perguntas e Respostas - Jano</title>

    <meta name="theme-color" content="#1B4332">
    <meta name="apple-mobile-web-app-capable" content="yes"> 
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> 
    <meta name="apple-mobile-web-app-title" content="Jano">
    <link rel="icon" href="assets/images/favicon.png?v=2" type="image/png">
    <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png?v=2">
    <link rel="manifest" href="/manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,700;1,400&family=Lato:wght@400;700&family=Montserrat:wght@400;700;900&display.swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css?v=1.9">

    <style>
    /* Seus estilos customizados ... (sem alteração) */
    :root {
        --verde-escuro: #1B4332;
        --cor-girassol: #FFEE8C;
        --branco-puro: #FFFFFF;
        --off-white: #fdfaf6;
        --cinza-texto: #555;
    }
    .font-new-kansas { font-family: 'New Kansas', serif; }
    .bg-verde-escuro { background-color: var(--verde-escuro); }
    .text-verde-escuro { color: var(--verde-escuro); }
    .bg-girassol { background-color: var(--cor-girassol); }
    .text-girassol { color: var(--cor-girassol); }
    .btn-verde {
        background-color: var(--verde-escuro);
        color: var(--branco-puro);
        padding: 12px 24px;
        border-radius: 99px;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .btn-verde:hover { opacity: 0.9; transform: translateY(-2px); }
    .btn-girassol {
        background-color: var(--cor-girassol);
        color: var(--verde-escuro);
        padding: 12px 24px;
        border-radius: 99px;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .btn-girassol:hover { opacity: 0.9; transform: translateY(-2px); }

    /* --- REFINAMENTO "AMIGÁVEL" (Estilo Doctoralia v6) --- */
    /* ... (Estilos dos cards de pergunta e resposta permanecem os mesmos) ... */
    .qa-card {
        background-color: transparent;
        box-shadow: none;
        border: none;
        margin-bottom: 32px;
    }
    .qa-card-question {
        background-color: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.07);
        position: relative;
        padding: 24px;
        margin-bottom: 25px;
    }
    .qa-card-answer {
        background-color: var(--branco-puro);
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.07);
        margin-top: 16px;
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 0;
        padding: 0;
        overflow: hidden;
        border-top: none;
        position: relative; 
    }
    .answer-text-content {
        padding: 24px;
        line-height: 1.7;
        color: #333;
        word-break: break-word;
    }
    .answer-text-content .data-answer-content {
        margin: 0;
    }
    .answer-psy-sidebar {
        background-color: #f2f4f5; /* Sua cor cinza atual */
        border-left: 1px solid #e0e0e0; 
        padding: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        position: relative; 
    }
    .answer-psy-sidebar::before {
        content: '';
        position: absolute;
        top: 34px;
        left: -10px;
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-right: 10px solid #f2f4f5; /* Sua cor cinza atual */
    }
    .answer-psy-sidebar img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        margin-bottom: 12px;
        object-fit: cover;
    }
    .answer-psy-sidebar .data-psy-name {
        font-family: 'New Kansas', serif;
        font-weight: 700;
        color: var(--verde-escuro);
        font-size: 1.1rem;
    }
    .answer-psy-sidebar .data-psy-crp {
        font-size: 0.9rem;
        color: var(--cinza-texto);
        margin-bottom: 10px;
    }
    .answer-psy-sidebar .answer-rating {
        color: #f39c12;
        margin-bottom: 16px;
        font-size: 0.9rem;
    }
    /* AJUSTE 2: Renomeado para .btn-ver-perfil */
    .answer-psy-sidebar .btn-ver-perfil {
        width: auto; 
        text-align: center;
        padding: 10px 16px;
    }
    @media (max-width: 768px) {
        .qa-card-answer {
            grid-template-columns: 1fr;
        }
        .answer-psy-sidebar {
            border-left: none;
            border-top: 1px solid #e0e0e0;
        }
        .answer-psy-sidebar::before {
            display: block;
            top: -10px;
            left: 40px;
            border-top: none; 
            border-right: 10px solid transparent; 
            border-left: 10px solid transparent;
            border-bottom: 10px solid #f2f4f5; /* Sua cor cinza atual */
        }
    }
    .active-pro-card {
        display: flex;
        align-items: center;
        gap: 15px;
        background: #fff;
        border: 1px solid #eee;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .active-pro-card img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
    }
    .pro-info .pro-name {
        font-family: 'New Kansas', serif;
        font-weight: bold;
        color: var(--verde-escuro);
        font-size: 1.1rem;
        margin: 0;
    }
    .pro-info .pro-specialty, .pro-info .pro-location {
        font-size: 0.9rem;
        color: var(--cinza-texto);
        margin: 2px 0;
    }
    .pro-info .pro-rating {
        color: #f39c12;
        font-size: 1rem;
        margin-top: 5px;
    }
    .pro-metric {
        margin-left: auto;
        text-align: center;
        flex-shrink: 0;
    }
    .pro-metric .metric-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--verde-escuro);
        display: block;
        line-height: 1.2;
    }
    .pro-metric .metric-label {
        font-size: 0.75rem; /* 12px */
        color: var(--cinza-texto);
        max-width: 100px;
        display: block;
        line-height: 1.3;
    }
    .disclaimer-text {
        font-size: 0.75rem; /* 12px */
        color: #888; /* Cinza claro */
        text-align: center;
        max-width: 800px; /* Mais largo, como na imagem */
        margin: 40px auto 0 auto;
        line-height: 1.5;
    }
    /* AJUSTE 2: Renomeado para .btn-ver-perfil */
    .btn-ver-perfil {
        background-color: var(--verde-escuro);
        color: var(--branco-puro);
        padding: 8px 16px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 700;
        font-size: 0.9rem;
        transition: opacity 0.3s;
    }
    .btn-ver-perfil:hover {
        opacity: 0.8;
    }
    .modal-overlay { /* Este modal ainda é usado pelo botão de login do PWA */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(27, 67, 50, 0.6);
        backdrop-filter: blur(5px);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    .modal-overlay.is-visible { opacity: 1; pointer-events: auto; }
    .modal-content {
        background-color: var(--branco-puro);
        border-radius: 16px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        transform: scale(0.95);
        transition: transform 0.3s ease;
    }
    .modal-overlay.is-visible .modal-content { transform: scale(1); }


    /* --- Estilos da Caixa de Pergunta Anônima --- */
    .ask-box-container {
        background-color: #f0f9f6; /* Verde-claro sutil */
        border: 1px solid #d4e9e2; /* Borda verde sutil */
        border-radius: 16px;
        padding: 24px;
        max-width: 1024px; /* (Valor do 'max-w-5xl' do grid acima) */
        margin: 40px auto 0 auto; /* Centraliza a caixa */
    }
    .ask-box-container h3 {
        font-family: 'New Kansas', serif;
        font-size: 1.5rem;
        color: var(--verde-escuro);
        margin-top: 0;
        margin-bottom: 10px;
        text-align: left;
    }
    .ask-box-container textarea {
        width: 100%;
        height: 120px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        resize: vertical;
        font-family: 'Lato', sans-serif;
        font-size: 1rem;
    }
    .ask-box-container textarea:focus {
        outline: none;
        border-color: var(--verde-escuro);
        box-shadow: 0 0 0 2px rgba(27, 67, 50, 0.2);
    }
    .ask-disclaimers {
        list-style-type: disc;
        list-style-position: inside;
        padding-left: 5px;
        margin-top: 20px;
        font-size: 0.85rem; /* 13px */
        color: var(--cinza-texto);
        text-align: left;
    }
    .ask-disclaimers li {
        margin-bottom: 8px;
        line-height: 1.5;
    }
    .ask-box-submit {
        display: flex; /* Para alinhar o botão */
        justify-content: flex-start; /* Alinha à esquerda */
        margin-top: 20px;
    }
    /* Usando a classe .btn-verde que já existe, mas com ajustes */
    .ask-box-submit .btn-verde {
        padding: 10px 30px; 
        border-radius: 8px; /* Menos arredondado */
    }
    
    /* --- Feedback do Formulário --- */
    .form-feedback {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        font-size: 0.875rem; /* 14px */
    }
    .char-counter {
        color: var(--cinza-texto);
    }
    .error-message {
        color: #b91c1c; /* Vermelho escuro */
        font-weight: bold;
    }
    /* Botão desabilitado */
    .btn-verde:disabled {
        background-color: #ccc;
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }

    /* --- Toast de Sucesso --- */
    .jano-toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: var(--verde-escuro);
        color: var(--branco-puro);
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        font-family: 'Lato', sans-serif;
        font-weight: 700;
        z-index: 2000;
        
        /* Animação */
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }
    .jano-toast.show {
        opacity: 1;
        transform: translateX(0);
    }

    /* --- Estilo da Barra de Busca --- */
    .search-bar-container {
        max-width: 1024px; /* Mesmo max-width do grid e da ask-box */
        margin: 40px auto 0 auto; /* Posição entre o grid e a ask-box */
        position: relative;
    }
    .search-bar-container input {
        width: 100%;
        padding: 16px 24px; /* Mais alto e confortável */
        padding-left: 60px; /* Espaço para o ícone */
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        font-size: 1rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .search-bar-container input:focus {
        outline: none;
        border-color: var(--verde-escuro);
        box-shadow: 0 0 0 3px rgba(27, 67, 50, 0.2);
    }
    .search-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--cinza-texto);
        width: 24px;
        height: 24px;
    }

</style>
</head>
<body class="bg-off-white">

    <div id="header-placeholder"></div>

    <main class="py-16 px-4">
        <div class="container mx-auto max-w-5xl text-center">
            
            <h1 class="font-new-kansas text-verde-escuro text-4xl md:text-5xl font-bold">Perguntas e Respostas</h1>
            <p class="text-lg text-gray-600 mt-4 mb-8">Tire suas dúvidas sobre saúde mental com os profissionais da nossa plataforma.</p>
            <p class="text-md text-gray-500 max-w-2xl mx-auto">Este é um espaço seguro. Pacientes registrados enviam perguntas e psicólogos verificados da nossa comunidade respondem. A sua dúvida pode ajudar outras pessoas.</p>
            
            <div class="mt-16 mb-12 max-w-5xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                        <h3 class="font-new-kansas text-xl font-bold text-verde-escuro mb-2">100% Gratuito</h3>
                        <p class="text-gray-600 text-sm">Este é um serviço totalmente gratuito, oferecido como parte do nosso compromisso com o acesso à informação de qualidade sobre saúde mental.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                        <h3 class="font-new-kansas text-xl font-bold text-verde-escuro mb-2">Construído por Profissionais</h3>
                        <p class="text-gray-600 text-sm">As respostas são fornecidas voluntariamente por psicólogos verificados da comunidade Jano. (Tempo médio de resposta: 24-48h).</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                        <h3 class="font-new-kansas text-xl font-bold text-verde-escuro mb-2">Seguro e Anônimo</h3>
                        <p class="text-gray-600 text-sm">Sua pergunta é pública para ajudar outras pessoas, mas sua identidade é sempre protegida. (Não inclua dados pessoais na pergunta).</p>
                    </div>
                </div>
            </div>

            <div class="search-bar-container">
                <div class="search-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                </div>
                <input type="text" id="qa-search-input" placeholder="Busque por ansiedade, depressão, terapia...">
            </div>


            <div class="ask-box-container">
                <h3 class="font-new-kansas">Pergunte aqui!</h3>
                <form id="anonymous-question-form">
                    <textarea id="question-text" placeholder="Escreva aqui sua dúvida..."></textarea>
                    
                    <div class="form-feedback">
                        <span id="char-error-message" class="error-message"></span>
                        <span id="char-counter" class="char-counter">0/50 caracteres mínimos</span>
                    </div>

                    <ul class="ask-disclaimers">
                        <li>Este espaço é informativo e <strong>não substitui terapia</strong> ou consulta. Em caso de crise ou urgência, não use este formulário. Acesse nossos <a href="recursos_crise.html" class="text-verde-escuro font-bold underline">recursos de emergência</a> ou ligue para o <strong>CVV (188)</strong>.</li>
                        <li>Para receber a melhor orientação, seja <strong>claro(a) e objetivo(a)</strong>. Isso ajuda nossa rede de Psis a focar no que realmente importa.</li>
                        <li>Sua pergunta é <strong>100% anônima</strong>. Sua identidade é totalmente protegida.</li>
                        <li>Esta é uma pergunta à nossa <strong>comunidade de Psicólogos(as)</strong>. Sua dúvida será respondida pela nossa rede de profissionais, não por um psicólogo específico.</li>
                        <li>Para garantir uma resposta ética, foque em <strong>dúvidas gerais</strong>. Perguntas sobre casos específicos (ex: "meu filho...", "minha parceira...") ou pedidos de segunda opinião não poderão ser respondidas.</li>
                        </ul>

                    <div class="ask-box-submit">
                        <button type="submit" class="btn-verde" id="submit-question-btn" disabled>Enviar Pergunta</button>
                    </div>
                </form>
            </div>

        </div>
    </main>

    <section class="pb-24 px-4">
        <h2 class="font-new-kansas text-verde-escuro text-3xl font-bold text-center mb-12">Últimas perguntas respondidas</h2>
        <div id="qa-container" class="container mx-auto max-w-5xl pt-0">
            </div>
    </section>
    
    <section class="bg-off-white py-16 px-4 relative">
        <div class="container mx-auto max-w-4xl">
            <h2 class="font-new-kansas text-verde-escuro text-3xl font-bold text-center mb-12">
                Profissionais de saúde mais ativos nos últimos 30 dias
            </h2>

            <div id="active-professionals-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <div class="active-pro-card">
                    <img src="https://placehold.co/100x100/1B4332/FFEE8C?text=HM" alt="Foto de Helio Martins">
                    <div class="pro-info">
                        <h3 class="pro-name">Helio Martins</h3>
                        <p class="pro-specialty">Psicólogo</p>
                        <p class="pro-location">São Bernardo do Campo</p>
                        <div class="pro-rating">★★★★★</div>
                    </div>
                    <div class="pro-metric">
                        <span class="metric-number">721</span>
                        <span class="metric-label">Respostas dadas nos últimos 30 dias</span>
                    </div>
                </div>

                <div class="active-pro-card">
                    <img src="https://placehold.co/100x100/1B4332/FFEE8C?text=AS" alt="Foto de Anthony Souza">
                    <div class="pro-info">
                        <h3 class="pro-name">Anthony Souza</h3>
                        <p class="pro-specialty">Psicólogo</p>
                        <p class="pro-location">Amparo</p>
                        <div class="pro-rating">★★★★★</div>
                    </div>
                    <div class="pro-metric">
                        <span class="metric-number">691</span>
                        <span class="metric-label">Respostas dadas nos últimos 30 dias</span>
                    </div>
                </div>
            </div>

            <div class="disclaimer-text">
                Todos os conteúdos publicados no Jano, principalmente perguntas e respostas, são de caráter meramente informativo e não devem ser, em nenhuma circunstância, considerados como substitutos de aconselhamento médico.
            </div>
        </div>
        
        <div class="wave-divider">
            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path d="M985.66,92.83C906.67,72,823.78,31,743.84,14.19c-82.26-17.34-168.06-16.33-250.45.39-57.84,11.73-114,31.07-172,41.86A600.21,600.21,0,0,1,0,27.35V120H1200V95.8C1132.19,118.92,1055.71,111.31,985.66,92.83Z" class="shape-fill" style="fill:#1B4332;"></path>
            </svg>
        </div>
    </section>

    <div id="footer-placeholder"></div>

  <template id="qa-card-template">
        <div class="qa-card">
            <div class="qa-card-question">
                <h2 class="font-new-kansas text-2xl font-bold text-verde-escuro mb-2 data-question-title"></h2>
                <p class="text-gray-700 mb-4 data-question-content"></p>
                <span class="text-sm text-gray-500">Perguntado por <strong class="data-patient-name"></strong></span>
            </div>
            <div class="qa-card-answers-container"></div>
        </div>
    </template>

    <template id="qa-answer-template">
        <div class="qa-card-answer">
            
            <div class="answer-text-content">
                <p class="data-answer-content">Carregando resposta...</p>
            </div>
            
            <div class="answer-psy-sidebar">
                <img class="data-psy-photo" src="https://placehold.co/60x60/1B4332/FFEE8C?text=Psi" alt="Foto do profissional">
                <h4 class="data-psy-name">Nome do Psicólogo</h4>
                <p class="data-psy-crp">CRP 00/000000</p>
                <div class="answer-rating">★★★★★</div>
                <a href="perfil-publico.html" class="btn-ver-perfil">Ver perfil</a>
            </div>

        </div>
    </template>

    <div id="pwa-install-banner" class="pwa-banner" style="display: none;">
        <button id="pwa-banner-close" class="pwa-banner-close">&times;</button>
        <div class="pwa-banner-content">
            <img src="/assets/images/apple-touch-icon.png" alt="Ícone Jano" class="pwa-banner-icon">
            <div>
                <strong>Instale o Jano no seu iPhone</strong>
                <p>Tenha acesso mais rápido. Toque em 
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="16px" height="16px" style="display: inline-block; vertical-align: middle; margin-top: -2px;">
                        <path d="M 24.181641 0 C 23.496094 0.015625 22.847656 0.234375 22.3125 0.625 L 22.28125 0.65625 C 21.78125 1.03125 21.390625 1.515625 21.125 2.0625 L 21.09375 2.125 C 20.828125 2.671875 20.6875 3.296875 20.6875 3.9375 L 20.6875 28.0625 C 20.6875 28.671875 20.828125 29.28125 21.09375 29.84375 L 21.125 29.875 C 21.390625 30.4375 21.78125 30.9375 22.28125 31.3125 L 22.3125 31.34375 C 22.847656 31.734375 23.496094 31.953125 24.181641 31.96875 L 25.818359 31.96875 C 26.503906 31.953125 27.152344 31.734375 27.6875 31.34375 L 27.71875 31.3125 C 28.21875 30.9375 28.609375 30.4375 28.875 29.875 L 28.90625 29.84375 C 29.171875 29.28125 29.3125 28.671875 29.3125 28.0625 L 29.3125 3.9375 C 29.3125 3.296875 29.171875 2.671875 28.90625 2.125 L 28.875 2.0625 C 28.609375 1.515625 28.21875 1.03125 27.71875 0.65625 L 27.6875 0.625 C 27.152344 0.234375 26.503906 0.015625 25.818359 0 Z M 25 3.03125 L 36 14.03125 L 33.15625 16.875 L 27 10.71875 L 27 38 L 23 38 L 23 10.71875 L 16.84375 16.875 L 14 14.03125 Z M 11 36 L 11 47 L 39 47 L 39 36 L 35 36 L 35 43 L 15 43 L 15 36 Z"/>
                    </svg> 
                    e "Adicionar à Tela de Início".
                </p>
            </div>
        </div>
    </div>

    <div id="jano-toast" class="jano-toast">
        </div>

    <script src="/config.js?v=1.6"></script>
    <script src="script.js?v=1.6"></script>

    <script>
        // ===================================================================
        // LÓGICA DA PÁGINA (Integrada com API)
        // ===================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- 1. Seletores de Elementos ---
            const qaContainer = document.getElementById('qa-container');
            const questionTemplate = document.getElementById('qa-card-template');
            const answerTemplate = document.getElementById('qa-answer-template');
            const searchInput = document.getElementById('qa-search-input');
            
            const anonForm = document.getElementById('anonymous-question-form');
            const textArea = document.getElementById('question-text');
            const submitButton = document.getElementById('submit-question-btn');
            const charCounter = document.getElementById('char-counter');
            const errorMessage = document.getElementById('char-error-message');
            const minLength = 50;

            let allFetchedQuestions = []; // Armazena todas as perguntas para o filtro

            // --- 2. Função de Renderização ---
            // (Renderiza as perguntas na tela)
            function renderQuestions(questions = []) {
                if (!qaContainer || !questionTemplate || !answerTemplate) {
                    console.error("Elementos do template de Q&A não encontrados.");
                    return;
                }

                qaContainer.innerHTML = ''; // Limpa o container

                if (questions.length === 0) {
                     qaContainer.innerHTML = `<p class="text-center text-gray-500 italic p-6">Nenhuma pergunta encontrada para os termos buscados.</p>`;
                     return;
                }

                questions.forEach(question => {
                    const card = questionTemplate.content.cloneNode(true);
                    card.querySelector('.data-question-title').textContent = question.title;
                    card.querySelector('.data-question-content').textContent = question.content;
                    card.querySelector('.data-patient-name').textContent = question.patient.nome || 'Anônimo';

                    const answersContainer = card.querySelector('.qa-card-answers-container');
                    
                    if (question.answers && question.answers.length > 0) {
                        question.answers.forEach(answer => {
                            const answerCard = answerTemplate.content.cloneNode(true);
                            
                            answerCard.querySelector('.data-answer-content').textContent = answer.content;
                            
                            // Verifica se o psicólogo existe (importante para dados reais)
                            if (answer.psychologist) {
                                answerCard.querySelector('.data-psy-photo').src = answer.psychologist.fotoUrl || 'https://placehold.co/60x60/1B4332/FFEE8C?text=Psi';
                                answerCard.querySelector('.data-psy-name').textContent = answer.psychologist.nome;
                                answerCard.querySelector('.data-psy-crp').textContent = `CRP ${answer.psychologist.crp}`;
                                
                                // Link do perfil usando o 'slug'
                                const profileLink = `/${answer.psychologist.slug}`;
                                answerCard.querySelector('.btn-ver-perfil').href = profileLink;
                            }
                            
                            answersContainer.appendChild(answerCard);
                        });
                    } else {
                        const noAnswer = document.createElement('div');
                        noAnswer.className = 'text-center text-gray-500 italic p-6';
                        noAnswer.textContent = 'Esta pergunta ainda não foi respondida.';
                        answersContainer.appendChild(noAnswer);
                    }
                    
                    qaContainer.appendChild(card);
                });
            }

            // --- 3. Função de Filtro (Busca) ---
            function filterQuestions() {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredQuestions = allFetchedQuestions.filter(q => 
                    q.title.toLowerCase().includes(searchTerm) || 
                    q.content.toLowerCase().includes(searchTerm)
                );
                renderQuestions(filteredQuestions); // Re-renderiza a lista com os filtros
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', filterQuestions);
            }

            // --- 4. Carregamento Inicial (Fetch GET) ---
            async function fetchAndRenderQuestions() {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/qna/questions`);
                    if (!response.ok) {
                        throw new Error('Não foi possível buscar as perguntas.');
                    }
                    allFetchedQuestions = await response.json(); // Armazena na variável global
                    
                    if (allFetchedQuestions.length === 0) {
                         qaContainer.innerHTML = `<p class="text-center text-gray-500 italic p-6">Ainda não há perguntas respondidas. Seja o primeiro a perguntar!</p>`;
                    } else {
                        renderQuestions(allFetchedQuestions); // Renderiza tudo na primeira carga
                    }
                } catch (error) {
                    console.error("Erro ao carregar perguntas da API:", error);
                    qaContainer.innerHTML = `<p class="text-center text-red-500">Ocorreu um erro ao carregar as perguntas. Tente novamente mais tarde.</p>`;
                }
            }

            // --- 5. Lógica do Formulário (Fetch POST) ---
            if (anonForm && textArea && submitButton && charCounter && errorMessage) {
                
                textArea.addEventListener('input', () => {
                    const count = textArea.value.length;
                    if (count < minLength) {
                        errorMessage.textContent = `Faltam ${minLength - count} caracteres.`;
                        charCounter.textContent = `${count}/${minLength} caracteres mínimos`;
                        submitButton.disabled = true;
                    } else {
                        errorMessage.textContent = ''; 
                        charCounter.textContent = `${count} caracteres`;
                        submitButton.disabled = false;
                    }
                });

                anonForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (textArea.value.length < minLength) {
                        errorMessage.textContent = `Por favor, escreva pelo menos ${minLength} caracteres.`;
                        return;
                    }
                    
                    submitButton.disabled = true;
                    submitButton.textContent = 'Enviando...';

                    try {
                        const response = await fetch(`${API_BASE_URL}/api/qna/questions`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content: textArea.value })
                        });
                        
                        if (!response.ok) {
                           const errorData = await response.json();
                           throw new Error(errorData.message || 'Falha ao enviar a pergunta.');
                        }
                        
                        showJanoToast("Pergunta enviada! Ela será revisada e publicada em breve.");
                        textArea.value = '';
                        charCounter.textContent = `0/${minLength} caracteres mínimos`;
                    } catch (error) {
                        console.error("Erro ao enviar pergunta:", error);
                        showJanoToast(error.message || "Erro ao enviar. Tente novamente.");
                    } finally {
                        submitButton.disabled = true; // Permanece desabilitado
                        submitButton.textContent = 'Enviar Pergunta';
                    }
                });
            }

            // --- 6. Função Toast ---
            function showJanoToast(message) {
                const toast = document.getElementById('jano-toast');
                if (toast) {
                    toast.textContent = message;
                    toast.classList.add('show');
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, 4000);
                }
            }
            
            // --- 7. Ponto de Entrada ---
            fetchAndRenderQuestions();
        });
    </script>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
    
</body>
</html>